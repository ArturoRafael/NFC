<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
<section class="feature-tests" aria-hidden="true">
        <h3>Support in your browser</h3>

        
</section>
<p>
  <button class="btn btn-lg btn-default" onclick="Nfcwrite()">NFC WRITE</button>

  <button class="btn btn-lg btn-default" onclick="Nfcread()">NFC READ</button>
</p>

<div id="log"></div>

<script type="text/javascript">
	
  function Nfcwrite() {
      
    consoleLog('CLICK BUTTON WRITE.');
    if ('nfc' in navigator) {
      
      navigator.nfc.watch(function (message) {
      	//Push a text string to either a tag or peer
        consoleLog("NFC message received from URL " + message.url);
        if (message.data[0].recordType === 'empty') {
          navigator.nfc.push([{
            url: message.url,
            data: [{
              recordType: "text",
              data: 'Hello World'
            }]
          }]);
        }
        processMessage(message);
      }, {mode: 'any'})
      .then(() => consoleLog("Added a watch."))
      .catch(err => consoleLog("Adding watch failed: " + err.name));

        
    } else {
      consoleLog('NFC API not supported.');
    }
}


function Nfcread() {
    consoleLog('CLICK BUTTON READ.');
  if ('nfc' in navigator) {
    
    navigator.nfc.watch(function (message) {
      
      //Push a text string to either a tag or peer
      const reader = new NFCReader();
        //Read data from tag
        consoleLog("NFC message received from URL " + message.url);
        reader.onreading = message => {
          if (message.records[0].recordType == 'empty') {
            writer.push({
              url: message.url,
              records: [{ recordType: "text", data: 'Hello World' }]
            });
            return;
          }
        }
        reader.start ();
        consoleLog('Read message written by '+message.url);

          processMessage(message);
    }), {mode: 'any'}
    .then(() => consoleLog("Added a watch."))
    .catch(err => consoleLog("Adding watch failed: " + err.name));

      
  } else {
    consoleLog('NFC API not supported.');
  }
}



//Below we read various different kinds of data which can be stored on a tag.
function processMessage(message) {
  message.data.forEach(function (record) {
    if (record.recordType == "string") {
      consoleLog('Data is string: ' + record.data);
    } else if (record.recordType == "json") {
      processJSON(record.data);
    } else if (record.recordType == "url") {
      consoleLog("Data is URL: " + record.data);
    } else if (record.recordType == "opaque" && record.mediaType == 'image/png') {
      processPng(record.data);
    };
  });
}

function processPng(data) {
  consoleLog("Known image/png data");

  var img = document.createElement("img");
  img.src = URL.createObjectURL(new Blob(data, 'image/png'));
  img.onload = function () {
    window.URL.revokeObjectURL(this.src);
  };
}

function processJSON(data) {
  var obj = JSON.parse(data);
  consoleLog("JSON data: " + obj.myProperty.toString());
}

//show html
function consoleLog(data) {
  var logElement = document.getElementById('log');
  logElement.innerHTML += '<p>'+data+'</p>';

}

</script>
<script type="text/javascript" src="vendor.js"></script>
<script type="text/javascript" src="main.js"></script>
</body>

</html>